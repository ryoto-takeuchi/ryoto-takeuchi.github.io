<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ryoto Lab Tools</title>
<style>
  :root { --w: 980px; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif; line-height: 1.6; margin: 0; color: #222; }
  header { padding: 24px 16px; border-bottom: 1px solid #eee; }
  main { padding: 24px 16px; max-width: var(--w); margin: 0 auto; }
  h1, h2, h3 { margin: 0.6em 0 0.4em; }
  .grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
  @media (min-width: 900px){ .grid { grid-template-columns: 1fr 1fr; } }
  .card { border: 1px solid #e6e6e6; border-radius: 12px; padding: 16px; }
  .muted { color: #666; font-size: 0.92em; }
  label { display: block; font-weight: 600; margin: 8px 0 4px; }
  input, select, textarea { width: 100%; box-sizing: border-box; padding: 10px 12px; border: 1px solid #d4d4d4; border-radius: 8px; font-size: 14px; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .btn { display: inline-block; padding: 10px 14px; border-radius: 8px; border: 1px solid #ccc; background: #fafafa; cursor: pointer; }
  .btn.primary { background: #0a7cff; color: #fff; border-color: #0a7cff; }
  .out { background: #fbfdff; border: 1px solid #e8f1ff; padding: 10px 12px; border-radius: 8px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  .kv { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
  .right { text-align: right; }
  .small { font-size: 0.9em; }
  footer { max-width: var(--w); margin: 32px auto; padding: 0 16px 48px; color: #777; }
  .pill { display:inline-block; padding:4px 8px; border:1px solid #ddd; border-radius:999px; font-size:12px; margin-left:8px; }
</style>
</head>
<body>
<header>
  <div style="max-width: var(--w); margin: 0 auto;">
    <h1>Ryoto Takeuchi — Notes & Tools <span class="pill">static / free / no server</span></h1>
    <div class="muted">研究実績・教育メモ・簡易ツール。定数は編集＆自動保存できます。</div>
  </div>
</header>

<main>
  <section class="card">
    <h2>定数（ローカル保存）</h2>
    <div class="muted small">必要に応じて書き換え → 自動保存（localStorage）。数値は SI 単位（例：強度 W/m², 極性率 SI）。</div>
    <div class="grid" id="const-grid"></div>
    <div style="margin-top:10px;">
      <button class="btn" id="reset-const">定数をデフォルトに戻す</button>
      <button class="btn" id="export-const">定数をエクスポート</button>
      <input type="file" id="import-const" accept="application/json" style="display:none;">
      <button class="btn" id="import-const-btn">インポート</button>
    </div>
  </section>

  <section class="grid" style="margin-top:16px;">
    <!-- 1) Capture velocity -->
    <div class="card">
      <h2>捕獲可能速度 v<sub>max</sub>（U/k<sub>B</sub> → v）</h2>
      <div class="muted small">ポテンシャル深さ（温度換算）から \( v_\mathrm{max}=\sqrt{2U/m} \)。U = (U/k<sub>B</sub>)·k<sub>B</sub>。</div>
      <label>原子質量 m [amu]</label>
      <input type="number" id="cap-m-amu" step="0.01" value="88">
      <div class="row">
        <div>
          <label>ポテンシャル深さ U/k<sub>B</sub> [μK]</label>
          <input type="number" id="cap-UuK" step="0.1" value="50">
        </div>
        <div>
          <label>または U/k<sub>B</sub> [mK]</label>
          <input type="number" id="cap-UmK" step="0.001" value="">
        </div>
      </div>
      <div style="margin-top:10px;">
        <button class="btn primary" id="cap-run">計算</button>
      </div>
      <div class="out" id="cap-out" style="margin-top:10px;"></div>
    </div>

    <!-- 2) Vapor pressure -->
    <div class="card">
      <h2>蒸気圧（係数は入力値を使用）</h2>
      <div class="muted small">Antoine: \(\log_{10}P = A - \frac{B}{C+T}\)（P: bar 等）または Clausius–Clapeyron: \(\ln P = A - B/T\)。係数は下で指定。</div>
      <label>温度 T [K]</label>
      <input type="number" id="vp-T" step="0.1" value="800">
      <div class="row">
        <div>
          <label>方式</label>
          <select id="vp-model">
            <option value="antoine">Antoine（log10）</option>
            <option value="cc">Clausius–Clapeyron（ln）</option>
          </select>
        </div>
        <div>
          <label>圧力単位</label>
          <select id="vp-unit">
            <option value="Pa">Pa</option>
            <option value="Torr">Torr</option>
            <option value="mbar">mbar</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div><label>A</label><input type="number" id="vp-A" value="10.0" step="0.001"></div>
        <div><label>B</label><input type="number" id="vp-B" value="12000" step="0.1"></div>
      </div>
      <div class="row">
        <div><label>C（Antoineのみ、℃基準）</label><input type="number" id="vp-C" value="-200" step="0.1"></div>
        <div class="muted small" style="align-self:end;">※ 物質ごとに適切な係数をセットしてください</div>
      </div>
      <div style="margin-top:10px;">
        <button class="btn primary" id="vp-run">計算</button>
      </div>
      <div class="out" id="vp-out" style="margin-top:10px;"></div>
    </div>

    <!-- 3) Rabi frequency -->
    <div class="card">
      <h2>ラビ周波数</h2>
      <div class="muted small">選択式：<b>(a)</b> \(\Omega=\Gamma\sqrt{I/(2I_\mathrm{sat})}\)（許容遷移・共鳴近傍） / <b>(b)</b> \(\Omega=\mu E/\hbar\)（双極子モーメントから）。</div>
      <label>方式</label>
      <select id="rabi-mode">
        <option value="gsat">Γ と I<sub>sat</sub></option>
        <option value="mudip">μ と I</option>
      </select>
      <div id="rabi-gsat" style="margin-top:8px;">
        <div class="row">
          <div><label>自然幅 Γ / 2π [MHz]</label><input type="number" id="rabi-gammaMHz" step="0.001" value="32"></div>
          <div><label>飽和強度 I<sub>sat</sub> [mW/cm²]</label><input type="number" id="rabi-Isat" step="0.001" value="1.67"></div>
        </div>
        <label>強度 I [mW/cm²]</label>
        <input type="number" id="rabi-I" step="0.001" value="5.0">
      </div>
      <div id="rabi-mu" style="display:none; margin-top:8px;">
        <div class="row">
          <div><label>双極子モーメント μ [e·a<sub>0</sub>]</label><input type="number" id="rabi-mu-ea0" step="0.001" value="3.0"></div>
          <div><label>強度 I [W/m²]</label><input type="number" id="rabi-I-wm2" step="1" value="100"></div>
        </div>
      </div>
      <div style="margin-top:10px;">
        <button class="btn primary" id="rabi-run">計算</button>
      </div>
      <div class="out" id="rabi-out" style="margin-top:10px;"></div>
    </div>

    <!-- 4) Light shift -->
    <div class="card">
      <h2>ライトシフト（微分極性率方式）</h2>
      <div class="muted small">\(\Delta\nu=\dfrac{\Delta\alpha(\omega)\,I}{2\varepsilon_0 c h}\)。\(\Delta\alpha\) は <b>SI（C·m²/V）</b> で入力。</div>
      <div class="row">
        <div><label>Δα(ω) [C·m²/V]</label><input type="number" id="ls-dalpha" step="1e-40" value="1e-39"></div>
        <div><label>I [W/m²]</label><input type="number" id="ls-I" step="1" value="1000"></div>
      </div>
      <div style="margin-top:10px;">
        <button class="btn primary" id="ls-run">計算</button>
      </div>
      <div class="out" id="ls-out" style="margin-top:10px;"></div>
    </div>
  </section>

  <section class="card" style="margin-top:16px;">
    <h2>メモ／研究実績へのリンク</h2>
    <div class="muted small">後で Jekyll を併用してブログ化も可能。まずは手書きで始めて OK。</div>
    <label>Markdown っぽく書いてください（簡易）</label>
    <textarea id="notes" rows="6" placeholder="- 2025: XXX Conference invited talk
- Preprint: arXiv:2501.xxxxx
- …"></textarea>
    <div style="margin-top:10px;">
      <button class="btn" id="save-notes">保存</button>
    </div>
  </section>
</main>

<footer>
  <div class="small">© <span id="year"></span> Ryoto Takeuchi — 静的サイト（GitHub Pages）/ すべてクライアントサイド計算</div>
</footer>

<script>
/* ---------- Utilities ---------- */
const $ = (id) => document.getElementById(id);
const fmt = (x, u="") => (isFinite(x) ? x.toExponential(6) : "NaN") + (u?(" "+u):"");
const toNumber = (el) => {
  const v = parseFloat(el.value);
  return isFinite(v) ? v : NaN;
};
const lsGet = (k, def) => {
  try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : def; } catch { return def; }
};
const lsSet = (k, v) => { try { localStorage.setItem(k, JSON.stringify(v)); } catch {} };

/* ---------- Constants (SI) ---------- */
const DEFAULT_CONST = {
  kB: { val: 1.380649e-23, unit: "J/K", label: "ボルツマン定数 kB" },
  h:  { val: 6.62607015e-34, unit: "J·s", label: "プランク定数 h" },
  hbar:{ val: 1.054571817e-34, unit: "J·s", label: "換算プランク定数 ħ" },
  c:  { val: 299792458, unit: "m/s", label: "真空光速 c" },
  eps0:{ val: 8.8541878128e-12, unit: "F/m", label: "真空誘電率 ε0" },
  amu:{ val: 1.66053906660e-27, unit: "kg", label: "原子質量単位 u" },
  e:  { val: 1.602176634e-19, unit: "C", label: "電気素量 e" },
  a0: { val: 5.29177210903e-11, unit: "m", label: "Bohr 半径 a0" },
};
let CONST = lsGet("const.v1", DEFAULT_CONST);

function renderConst(){
  const host = $("const-grid");
  host.innerHTML = "";
  Object.entries(CONST).forEach(([k, obj])=>{
    const wrap = document.createElement("div");
    wrap.className = "card";
    wrap.innerHTML = `
      <label>${obj.label} <span class="muted small">[${obj.unit}]</span></label>
      <input type="number" step="any" data-key="${k}" value="${obj.val}">
    `;
    host.appendChild(wrap);
  });
  // attach listeners
  host.querySelectorAll("input").forEach(inp=>{
    inp.addEventListener("change", ()=>{
      const key = inp.dataset.key;
      const v = parseFloat(inp.value);
      if(!isFinite(v)) return;
      CONST[key].val = v;
      lsSet("const.v1", CONST);
    });
  });
}
renderConst();

$("reset-const").onclick = ()=>{ CONST = structuredClone(DEFAULT_CONST); lsSet("const.v1", CONST); renderConst(); };
$("export-const").onclick = ()=>{
  const blob = new Blob([JSON.stringify(CONST, null, 2)], {type: "application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "constants.json";
  a.click();
};
$("import-const-btn").onclick = ()=> $("import-const").click();
$("import-const").onchange = (e)=>{
  const f = e.target.files?.[0];
  if(!f) return;
  const rdr = new FileReader();
  rdr.onload = ()=> {
    try { CONST = JSON.parse(rdr.result); lsSet("const.v1", CONST); renderConst(); }
    catch { alert("JSON の読み込みに失敗しました"); }
  };
  rdr.readAsText(f);
};

/* ---------- Notes ---------- */
$("notes").value = lsGet("notes.v1", "");
$("save-notes").onclick = ()=> lsSet("notes.v1", $("notes").value);

/* ---------- 1) Capture velocity ---------- */
$("cap-run").onclick = ()=>{
  const m_amu = toNumber($("cap-m-amu"));
  const UuK = toNumber($("cap-UuK"));
  const UmK = toNumber($("cap-UmK"));
  const kB = CONST.kB.val;
  const amu = CONST.amu.val;

  const m = m_amu * amu; // kg
  let UkB; // [K]
  if(isFinite(UmK)) UkB = UmK * 1e-3;
  else UkB = UuK * 1e-6;

  const U = UkB * kB; // J
  const vmax = Math.sqrt(Math.max(0, 2*U/m)); // m/s
  const Eeq = 0.5*m*vmax*vmax; // check back
  $("cap-out").innerHTML =
    `<div class="kv"><div>m</div><div class="right">${fmt(m,"kg")}</div></div>
     <div class="kv"><div>U</div><div class="right">${fmt(U,"J")} （= ${fmt(U/kB,"K")}）</div></div>
     <div class="kv"><div>v<sub>max</sub></div><div class="right"><b>${vmax.toFixed(6)} m/s</b></div></div>`;
};

/* ---------- 2) Vapor pressure ---------- */
$("vp-run").onclick = ()=>{
  const T = toNumber($("vp-T")); // K
  const model = $("vp-model").value;
  const unit = $("vp-unit").value;
  const A = toNumber($("vp-A"));
  const B = toNumber($("vp-B"));
  const C = toNumber($("vp-C")); // for Antoine; T uses °C there

  if(!isFinite(T)||!isFinite(A)||!isFinite(B) || (model==="antoine" && !isFinite(C))) {
    $("vp-out").textContent = "入力値を確認してください。";
    return;
  }

  let P_base; // Pa
  if(model==="antoine"){
    // User is responsible for giving coefficients that yield pressure in known unit.
    // We'll assume Antoine returns pressure in bar (一般的ケースの一つ) → ここでは「bar と仮定」と明示し、必要なら係数を調整して使う。
    const Tc = T - 273.15;
    const log10P = A - B/(C + Tc); // P in "bar" (assumption; document to user)
    const P_bar = Math.pow(10, log10P);
    P_base = P_bar * 1e5; // bar → Pa
  } else {
    // Clausius–Clapeyron: ln P = A - B/T → ここでは P を Pa として扱う設計
    const lnP = A - B/T;
    P_base = Math.exp(lnP); // Pa
  }

  let P_disp = P_base, u = "Pa";
  if(unit==="Torr"){ P_disp = P_base / 133.322368; u = "Torr"; }
  else if(unit==="mbar"){ P_disp = P_base / 100; u = "mbar"; }

  $("vp-out").innerHTML =
    `<div class="kv"><div>P</div><div class="right"><b>${P_disp.toExponential(6)} ${u}</b></div></div>
     <div class="muted small">※ 係数の単位系前提（Antoine の P 単位など）は物質ごとに異なるため、<b>ご自身で検証</b>のうえ設定してください。</div>`;
};

/* ---------- 3) Rabi frequency ---------- */
$("rabi-mode").onchange = ()=>{
  const m = $("rabi-mode").value;
  $("rabi-gsat").style.display = (m==="gsat")?"block":"none";
  $("rabi-mu").style.display   = (m==="mudip")?"block":"none";
};
$("rabi-run").onclick = ()=>{
  const mode = $("rabi-mode").value;
  const hbar = CONST.hbar.val;
  const eps0 = CONST.eps0.val;
  const c = CONST.c.val;
  let Omega = NaN;

  if(mode==="gsat"){
    const gammaMHz = toNumber($("rabi-gammaMHz")); // Γ/2π [MHz]
    const Isat_mWcm2 = toNumber($("rabi-Isat"));
    const I_mWcm2 = toNumber($("rabi-I"));
    if(!isFinite(gammaMHz)||!isFinite(Isat_mWcm2)||!isFinite(I_mWcm2)){
      $("rabi-out").textContent = "入力値を確認してください。"; return;
    }
    const gamma = 2*Math.PI*gammaMHz*1e6; // rad/s
    const Isat = Isat_mWcm2 * 10; // mW/cm^2 → W/m^2（1 mW/cm^2 = 10 W/m^2）
    const I = I_mWcm2 * 10; // → W/m^2
    Omega = gamma * Math.sqrt(I/(2*Isat)); // rad/s
  } else {
    const mu_ea0 = toNumber($("rabi-mu-ea0"));
    const I = toNumber($("rabi-I-wm2")); // W/m^2
    if(!isFinite(mu_ea0)||!isFinite(I)){
      $("rabi-out").textContent = "入力値を確認してください。"; return;
    }
    // μ [C·m] = (e a0)*mu_ea0
    const mu = CONST.e.val * CONST.a0.val * mu_ea0;
    const E = Math.sqrt(2*I/(eps0*c)); // V/m
    Omega = (mu * E) / hbar; // rad/s
  }

  const Omega_2pi = Omega/(2*Math.PI); // Hz
  $("rabi-out").innerHTML =
    `<div class="kv"><div>Ω</div><div class="right">${fmt(Omega,"rad/s")}</div></div>
     <div class="kv"><div>Ω/2π</div><div class="right"><b>${Omega_2pi.toFixed(3)} Hz</b></div></div>`;
};

/* ---------- 4) Light shift ---------- */
$("ls-run").onclick = ()=>{
  const dalpha = toNumber($("ls-dalpha")); // C·m^2/V
  const I = toNumber($("ls-I")); // W/m^2
  if(!isFinite(dalpha)||!isFinite(I)){ $("ls-out").textContent = "入力値を確認してください。"; return; }
  const eps0 = CONST.eps0.val, c = CONST.c.val, h = CONST.h.val;
  const dnu = (dalpha * I) / (2 * eps0 * c * h); // Hz
  $("ls-out").innerHTML =
    `<div class="kv"><div>Δν</div><div class="right"><b>${dnu.toFixed(6)} Hz</b></div></div>`;
};

/* ---------- misc ---------- */
$("year").textContent = new Date().getFullYear();
</script>
</body>
</html>
